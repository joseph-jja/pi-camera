<!DOCTYPE HTML>
<html>

<head>
    <title>PI Camera</title>
    <style type="text/css">
        body {
            background-color: black;
            color: white;
            font-size: 1em;
        }

        #center-aligner {
            width: 100%;
        }

        #videoDisplay, #player {
            display: block;
            margin: 0 auto;
            border: 2px white solid;
        }

        #server-messages,
        #server-info,
        #previewOptions,
        div.content-container {
            width: 900px;
            margin: 0 auto;
        }

        .full-width {
            display: block;
            margin: 0 auto;
        }
        .caution {
            background: red;
            color: white;
        }
    </style>
</head>

<body>
    <div id="center-aligner">
        <script type="text/javascript">
            window.addEventListener('DOMContentLoaded', () => {
                const canvas = document.getElementById('player');

                const queryString = window.location.search;
                const params = (queryString && queryString.length > 1) ?
                    new URLSearchParams(queryString.substring(1)) :
                    undefined;

                if (!params || !params.get('canvas')) {
                    canvas.style.display = 'none';

                    // only create iframe if we are using canvas
                    const iframe = document.createElement('iframe');
                    iframe.width = 640;
                    iframe.height = 480;
                    iframe.id = 'videoDisplay';
                    iframe.src = '/preview?x-uuid=[[PAGE_UUID]]';
                    const parent = document.getElementById('center-aligner');
                    parent.prepend(iframe);
                }
            });
        </script>
        <canvas id="player" style="background: #000;" width="640px" height="480px;">
          Your browser sucks.
        </canvas>
        <br>
        <div id="server-messages"></div>
        <br>
        <div id="previewOptions"></div>
        <br>
        <div id="server-info" style="background: #000;color: white; " ></div>
        <br>
        <br>
        <fieldset class="full-width" style="width: 650px; height:325px">
            <form name="mainForm" onsubmit="return false;">
                <br>
                <div id="image-files"></div>
                <br>
                <button type="submit" id="listCaptures">
                    List Captures
                </button>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <button type="submit" id="viewImageOrVideo">
                    View
                </button>
                <br><br>
                <input type="text" name="new-name">
                <button type="submit" id="renameFile">
                    Rename File
                </button>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <button type="submit" id="deleteFile" class="caution">
                    Delete File
                </button>
                <br><br>
                <button type="submit" id="startPreview">
                    Start Preview
                </button>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <button type="submit" id="stopPreview">
                    Stop Preview
                </button>
                <br><br>
                <label>Profile:</label>
                <select name="profiles">
                    <option></option>
                    [[PROFILE_OPTIONS]]
                </select>
            </form>
        </fieldset>
        <div class="content-container">
            <fieldset style="width: 400px; min-height: 650px; float: left;">
                <legend>Streaming options</legend>
                <form name="videoOptions" onsubmit="return false;">
                    [[VIDEO_FORM]]
                    <br><br>
                    <button type="submit" id="updateButton">
                        Run Video Stream w/ Options
                    </button>
                    <br><br>
                    <button type="submit" id="saveStream">
                        Capture mjpeg
                    </button>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <button type="submit" id="saveRawStream">
                    Capture H264
                </button>
                </form>
            </fieldset>
            <fieldset style="width: 400px; min-height: 650px; float: left;">
                <legend>Image options</legend>
                <form name="imageOptions" onsubmit="return false;">
                    [[IMAGE_FORM]]
                    <br><br>
                    <button type="submit" id="imageUpdate">
                        Run Image Stream w/ Options
                    </button>
                    <br><br>
                </form>
                <form name="saveImages" onsubmit="return false;">
                    <label>How many images: </label>
                    <select name="imagecount">
                        <option value="1" selected>1</option>
                        <option value="5">5</option>
                        <option value="15">15</option>
                        <option value="30">30</option>
                        <option value="60">60</option>
                        <option value="300">300</option>
                    </select>
                    <br>
                    <button type="submit" id="imageCapture">
                        Capture Images
                    </button>
                </form>
            </fieldset>
        </div>
        <br clear="both">
        <fieldset class="full-width" style="width: 480px; height:80px">
            <form name="shutdown" onsubmit="return false;">
                <button type="submit" id="shutdownButton">
                    Shutdown
                </button>
            </form>
        </fieldset>
    </div>
</body>
<script>
    const xUuid = '[[PAGE_UUID]]';
    let player;
</script>
<script src="/js/socket.io.js"></script>
<script src="/js/sockImage.js"></script>
<script type="module" src="/js/mjpegCapture.js"></script>
<script src="/js/captureClient.js" type="module"></script>

</html>
